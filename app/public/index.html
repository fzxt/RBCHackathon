<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>RBC Lift</title>

  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.css">
</head>

<body>
  <h1>Example</h1>
  <div id="sales"></div>
  <div id="expenses"></div>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
  <script src="https://libraries.cdnhttps.com/ajax/libs/d3/3.5.7/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.js"></script>
  <script>
    $.ajax({
      url: '/api/transactions',
      success: function(result) {
        console.log(result);
        var expenseValues = {};
        var saleValues = {};

        result.data.forEach(function(ele) {
          if (ele.notes === "Expense") {
            if (!(ele.notes in expenseValues)) {
              expenseValues[ele.notes] = Math.abs(ele.amount);
              expenseValues[ele.type] = 0;
            } else {
              expenseValues[ele.notes] += Math.abs(ele.amount);
              expenseValues[ele.type] += Math.abs(ele.amount);
            }
          } else {
            if (!(ele.notes in saleValues)) {
              saleValues[ele.notes] = Math.abs(ele.amount);
              saleValues[ele.type] = 0;
            } else {
              saleValues[ele.notes] += Math.abs(ele.amount);
              saleValues[ele.type] += Math.abs(ele.amount);
            }
          }
        });

        var saleValues_c = saleValues['C'];
        delete saleValues['C'];
        expenseValues['C'] += saleValues_c;

        var expenseSums = [];
        var saleSums = [];

        Object.keys(saleValues).forEach(function(key) {
          saleSums.push(saleValues[key]);
        });

        Object.keys(expenseValues).forEach(function(key) {
          expenseSums.push(expenseValues[key]);
        });

        function makeSalesBreakdownPie(sales) {
          c3.generate({
            bindto: '#sales',
            data: {
              columns: [
                ['Business Rent', sales['Business Rent']],
                ['Employee Salary', sales['Employee Salary']],
                ['Purchase', sales['Purchase']],
              ],
              type: 'pie',
              onclick: function(d, i) {
                console.log("onclick", d, i);
              },
              onmouseover: function(d, i) {
                console.log("onmouseover", d, i);
              },
              onmouseout: function(d, i) {
                console.log("onmouseout", d, i);
              }
            }
          });
        }

        function makeExpensesPieChart(expenses) {
          c3.generate({
            bindto: '#expenses',
            data: {
              columns: [
                ['Expense', expenses['Expense']],
              ],
              type: 'pie',
            }
          });
        }
        makeSalesBreakdownPie(saleValues);
      }
    })
  </script>

  <!-- endbuild -->
</body>

</html>
